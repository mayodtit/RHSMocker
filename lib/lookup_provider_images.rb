require 'csv'

class LookupProviderImages

  def self.do
    npi_map = {}
    provider_npis.each_with_index do |npi, i|
      img = filter_image_url(DataSources::BetterDoctor.lookup_by_npi(npi)[:image_url])

      img && npi_map[npi] = img

      num = "#{i}".rjust(5)

      puts "#{num} - NPI: #{npi} - #{npi_map[npi]}"
      sleep 1
    end

    write_npi_map_to_csv(npi_map)

    npi_map
  end

  def self.write_npi_map_to_csv(npi_map)
    filename = Rails.root.join('lib', 'assets', "provider_image_urls_#{Time.now.strftime("%Y%m%d_%H%M%S")}.csv")
    puts "WRITING #{npi_map.keys.count} IMAGES TO #{filename}"
    CSV.open(filename, "w") do |csv|
      csv << ["npi","image_url"]
      npi_map.each{|npi, image_url| csv << [npi, image_url] }
    end
  end

  def self.load_npi_image_map
    file = File.read(Rails.root.join('lib', 'assets', 'provider_image_urls.csv'), encoding: 'ISO-8859-1')
    csv = CSV.parse(file, headers: true)

    npi_map = {}

    puts "***** PROCESSING CSV OF LENGTH #{csv.length} *****"
    csv.inject(0) do |count, row|
      npi_map[row["npi"]] = row["image_url"]
    end

    npi_map
  end

  def self.filter_image_url(url)
    return nil if url.nil?
    return nil if /general_doctor_/ =~ url
    url
  end

  def self.provider_npis
    ["1003065079","1003807314","1003808049","1003808361","1003819269","1003840547","1003843517","1003864778","1003867912","1003879115","1003880493","1003895368",
     "1003902180","1003997552","1013002328","1013019637","1013043488","1013068881","1013080035","1013080894","1013086347","1013097005","1013104504","1013236181",
     "1013900471","1013906445","1013908599","1013911395","1013917046","1013929660","1013942580","1013961861","1013982750","1013997865","1013998715","1023018876",
     "1023040748","1023055506","1023079985","1023081445","1023093853","1023105723","1023109725","1023163169","1033106042","1033112164","1033122114","1033155890",
     "1033180641","1033195797","1033205539","1033206123","1033249099","1033265491","1033268057","1033287032","1043204597","1043206261","1043220940","1043224637",
     "1043230741","1043258726","1043276017","1043282296","1043288061","1043323652","1043339419","1043374879","1043375074","1043382856","1043387632","1043396112",
     "1043431893","1043442841","1043471840","1043479090","1053311530","1053317750","1053332957","1053358853","1053359562","1053362723","1053376590","1053380428",
     "1053383414","1053407114","1053410357","1053594770","1063411742","1063415214","1063429470","1063464246","1063466886","1063467405","1063478311","1063479939",
     "1063483436","1063487601","1063488419","1063492270","1063502912","1063504553","1063679017","1063733657","1063773612","1073500948","1073509204","1073513677",
     "1073538047","1073547170","1073560371","1073561619","1073563433","1073567392","1073576963","1073585568","1073586582","1073596367","1073624029","1073652152",
     "1083601348","1083605646","1083649339","1083652721","1083654388","1083664593","1083667133","1083673222","1083686059","1083689475","1083708408","1083725964",
     "1083748784","1083777379","1083804983","1083831812","1083847578","1083888481","1083909220","1093708984","1093725483","1093739393","1093744955","1093751133",
     "1093770919","1093782799","1093817728","1093829707","1093845513","1093853897","1093860975","1093946899","1104082908","1104111509","1104803618","1104824366",
     "1104839620","1104844059","1104856582","1104869155","1104875525","1104882653","1104907542","1104913516","1104932540","1104938786","1104943976","1104963081",
     "1114007093","1114028453","1114038221","1114062445","1114169646","1114903036","1114912680","1114923125","1114932084","1114932746","1114946506","1114959046",
     "1114974888","1114976396","1114980232","1114981404","1114988169","1124006242","1124009691","1124041413","1124059514","1124076617","1124097852","1124121934",
     "1124129747","1124192695","1124195250","1124221502","1124280581","1124312376","1124350442","1134100464","1134106388","1134114861","1134118961","1134122955",
     "1134128572","1134137540","1134170095","1134172893","1134184625","1134193469","1134217730","1134226780","1134235450","1134268451","1134269723","1134279391",
     "1134291396","1134298771","1134301138","1134347545","1134362429","1134375124","1134375272","1134380298","1144200353","1144209644","1144219544","1144233370",
     "1144256041","1144263369","1144270976","1144272808","1144274150","1144274747","1144281585","1144296708","1144323387","1144327875","1144368333","1144376419",
     "1144406083","1144411463","1144474156","1144481748","1144487281","1144527607","1144594201","1154311751","1154324192","1154326726","1154330249","1154347235",
     "1154349769","1154360550","1154375053","1154434868","1154437770","1154456606","1154466209","1154483196","1164402350","1164402913","1164407938","1164412144",
     "1164439980","1164443594","1164510798","1164519252","1164521027","1164523296","1164561171","1164561353","1164564217","1164614509","1164616371","1164632881",
     "1164643094","1164643359","1164649984","1164654232","1164691150","1164747671","1174503098","1174508758","1174514335","1174516462","1174541577","1174543474",
     "1174547087","1174563175","1174566772","1174568695","1174576599","1174583355","1174592778","1174595755","1174600365","1174601769","1174611263","1174622658",
     "1174629232","1174646012","1174787170","1174873715","1174887913","1174958185","1184604662","1184610271","1184614018","1184642613","1184647091","1184671018",
     "1184694168","1184702284","1184713463","1184792814","1184817165","1184857484","1184890980","1194143701","1194705392","1194706507","1194718916","1194719245",
     "1194725051","1194726240","1194734426","1194746842","1194765248","1194779389","1194789651","1194791418","1194793356","1194831727","1194833475","1194916999",
     "1194992073","1205000270","1205015534","1205075538","1205802626","1205815602","1205836285","1205861820","1205869104","1205903499","1205908027","1205914884",
     "1205918695","1205930955","1205944493","1205948387","1205956802","1205961935","1215039284","1215195532","1215901418","1215905005","1215907860","1215908132",
     "1215921911","1215923586","1215924105","1215940762","1215945266","1215945530","1215947874","1215951868","1215968060","1215974191","1215981642","1215981758",
     "1215990494","1225009764","1225012016","1225015308","1225027238","1225032105","1225046022","1225046717","1225056526","1225066368","1225067606","1225073356",
     "1225124266","1225239346","1225242506","1225359961","1235107830","1235109596","1235115106","1235118639","1235162447","1235199753","1235213208","1235230368",
     "1235231903","1235253576","1235295619","1235324716","1235329566","1235349812","1235482829","1245205640","1245218353","1245221985","1245222033","1245222470",
     "1245222744","1245223601","1245231109","1245233782","1245244391","1245250745","1245251362","1245259324","1245259399","1245270859","1245282631","1245287663",
     "1245322551","1245355593","1245359397","1245466275","1245492644","1245494806","1255306973","1255315693","1255324703","1255324901","1255332953","1255337556",
     "1255361788","1255366670","1255383469","1255408258","1255412813","1255428082","1255448189","1255451209","1255451654","1255455358","1255627980","1255653309",
     "1265407316","1265410773","1265434252","1265453955","1265469829","1265491500","1265505291","1265536486","1265542187","1265544712","1265585301","1265614341",
     "1265631907","1265650964","1265748891","1275501470","1275504664","1275513632","1275529141","1275531147","1275564189","1275574709","1275583213","1275601478",
     "1275620361","1275676595","1275723264","1275736803","1285604579","1285624254","1285630004","1285637116","1285639013","1285651620","1285654327","1285690412",
     "1285692061","1285714360","1285723635","1285743153","1285788489","1285905232","1285908590","1285984070","1295013365","1295057289","1295705770","1295732709",
     "1295746584","1295749778","1295792497","1295794386","1295807014","1295819969","1295824670","1295840783","1295857647","1295863488","1295912871","1306000948",
     "1306069380","1306174875","1306286927","1306822028","1306825799","1306826334","1306826524","1306870993","1306878673","1306878921","1306886635","1306900964",
     "1306918669","1306927454","1316053697","1316151764","1316229230","1316910300","1316924228","1316927635","1316936891","1316940315","1316945702","1316947666",
     "1316994403","1316999287","1326000498","1326011487","1326033200","1326036591","1326054180","1326057597","1326057951","1326058124","1326063439","1326063553",
     "1326066960","1326138645","1326154501","1326159617","1326173154","1326197633","1326253345","1326259789","1326364555","1326470683","1336124676","1336129956",
     "1336145440","1336152057","1336219484","1336228725","1336234368","1336271204","1336363670","1336395474","1336401728","1346205036","1346210572","1346212131",
     "1346213311","1346229200","1346238581","1346271665","1346299518","1346313434","1346319365","1346349065","1346392479","1346396637","1346401635","1346404852",
     "1356304646","1356309744","1356312466","1356312854","1356340327","1356359756","1356372643","1356393649","1356400758","1356408140","1356409239","1356444160",
     "1356476386","1356504518","1356510366","1356529531","1356536585","1356537906","1356570915","1356578132","1356637433","1356773592","1366414559","1366446130",
     "1366451213","1366452195","1366457772","1366471211","1366536088","1366599003","1366642308","1366646101","1376502203","1376527200","1376531624","1376540765",
     "1376562835","1376585950","1376616706","1376622662","1376636860","1376644286","1376646786","1376654566","1376687780","1376844720","1386606762","1386616415",
     "1386644250","1386649903","1386654366","1386697068","1386756047","1386790137","1386791267","1386852747","1396712691","1396721312","1396745683","1396748240",
     "1396814851","1396852653","1396870945","1396880423","1396894903","1396959987","1407054117","1407086317","1407100522","1407174881","1407183858","1407193980",
     "1407820897","1407824105","1407846850","1407847700","1407871106","1407876188","1407876436","1407896327","1407899149","1407899586","1407905383","1407908742",
     "1407941917","1407946411","1407986144","1407995400","1407999378","1417000159","1417034083","1417056581","1417061185","1417074139","1417122268","1417124769",
     "1417147547","1417155847","1417165838","1417167057","1417170739","1417174434","1417178260","1417916271","1417941360","1417944489","1417955980","1417984030",
     "1417998584","1427001296","1427012244","1427018670","1427027457","1427028505","1427030485","1427033828","1427035955","1427039056","1427052778","1427057272",
     "1427069236","1427092089","1427148055","1427168665","1427214410","1427371913","1437109493","1437120169","1437121589","1437135654","1437136702","1437155652",
     "1437167848","1437212636","1437219797","1437231479","1437243680","1437263068","1437278181","1437291135","1437292208","1437319191","1437335205","1437440815",
     "1437465473","1437488806","1447219878","1447224605","1447243431","1447267810","1447268875","1447269592","1447278940","1447282330","1447286547","1447290994",
     "1447332259","1447352711","1447412960","1457301780","1457346843","1457379349","1457401317","1457441164","1457447898","1457469249","1457552309","1457635740",
     "1457646929","1467403279","1467411744","1467417360","1467417980","1467429084","1467432096","1467435263","1467439430","1467474809","1467475475","1467498667",
     "1467511378","1467536607","1467560292","1467626937","1467666883","1467748061","1477548097","1477565794","1477570448","1477592665","1477595932","1477621241",
     "1477644110","1477654390","1477695781","1477717007","1477757375","1477758886","1477866218","1487074522","1487618831","1487619250","1487624003","1487647855",
     "1487655700","1487694790","1487697843","1487699112","1487706784","1487711875","1487727541","1487732038","1487739017","1487752622","1487761979","1487802716",
     "1487841722","1487842894","1497060776","1497083471","1497706147","1497709547","1497716211","1497733216","1497735682","1497736722","1497761985","1497794499",
     "1497795405","1497822902","1497856850","1497868350","1497946552","1497998595","1508014010","1508023227","1508054586","1508061243","1508063769","1508818915",
     "1508870965","1508894882","1508895442","1508897869","1508951534","1508966516","1508973991","1508985243","1518010560","1518022326","1518028109","1518054899",
     "1518101658","1518910660","1518953702","1518960145","1518990464","1528032489","1528044161","1528044849","1528046752","1528051539","1528054475","1528069606",
     "1528086147","1528087269","1528088515","1528089190","1528135589","1528142460","1528151578","1528153160","1528170206","1528252905","1528263522","1528333184",
     "1528356565","1528358546","1538107073","1538109004","1538111356","1538119557","1538123385","1538149018","1538149034","1538153796","1538180534","1538200852",
     "1538222054","1538252408","1538260054","1538309133","1548200082","1548224413","1548237894","1548250921","1548263734","1548266265","1548279201","1548323769",
     "1548330509","1548340110","1548387202","1548489248","1548677263","1558300723","1558312223","1558323758","1558333922","1558336362","1558349324","1558369686",
     "1558372805","1558393595","1558433557","1558477851","1558534552","1558538744","1558547844","1558570945","1558575647","1558598698","1568426542","1568438083",
     "1568449809","1568464097","1568466589","1568467132","1568482735","1568496560","1568548899","1568637239","1568686897","1578500021","1578500310","1578520151",
     "1578520425","1578523916","1578525697","1578537056","1578540381","1578556478","1578566840","1578579652","1578586376","1578589297","1578594586","1578645305",
     "1578651584","1578677019","1578690467","1578714549","1578767166","1578772604","1578775359","1588628705","1588639124","1588651582","1588653133","1588710453",
     "1588713507","1588720189","1588728372","1588734974","1588770325","1588773485","1588787451","1588856744","1588866024","1588875926","1588988240","1598024655",
     "1598716573","1598742306","1598742421","1598746471","1598780520","1598783185","1598824971","1598838658","1598839367","1598841371","1598869026","1598874422",
     "1598875973","1598885741","1598892374","1598892929","1609008143","1609073022","1609079516","1609083807","1609085240","1609099225","1609154186","1609820554",
     "1609840958","1609845288","1609846468","1609869569","1609871003","1609887355","1609939453","1609985290","1619038825","1619053436","1619062528","1619067998",
     "1619083250","1619083508","1619294279","1619900677","1619911757","1619921509","1619936804","1619949815","1619961315","1619970068","1629007760","1629015177",
     "1629028980","1629040340","1629044813","1629063748","1629068515","1629090071","1629092515","1629133061","1629157581","1629240684","1629283817","1629357256",
     "1639103740","1639107014","1639109515","1639137524","1639152630","1639174642","1639243249","1639268642","1639289432","1639355019","1639379514","1639463425",
     "1649243841","1649256165","1649279506","1649305772","1649332503","1649346784","1649358961","1649364746","1649365644","1649376278","1649388109","1649439720",
     "1649473588","1649696824","1659310894","1659325827","1659326312","1659342426","1659365674","1659379014","1659385581","1659438950","1659509669","1659586709",
     "1659593267","1659682987","1669401923","1669408498","1669430815","1669462073","1669476206","1669488821","1669532347","1669550687","1669556007","1669602090",
     "1669635363","1669691986","1669767000","1669783510","1679510978","1679541940","1679560478","1679563423","1679574107","1679576276","1679697023","1679779664",
     "1679807044","1689603268","1689645236","1689646549","1689651044","1689652489","1689652596","1689656175","1689662520","1689666257","1689679219","1689696916",
     "1689697203","1689721136","1689762833","1689781288","1689802928","1689849911","1689868150","1689905549","1699700914","1699726430","1699736587","1699747030",
     "1699747543","1699765594","1699771402","1699809723","1699822361","1699883199","1699939314","1700038635","1700048014","1700059987","1700113024","1700818036",
     "1700826153","1700842234","1700851193","1700860467","1700899184","1700928660","1700954278","1700964079","1700972502","1700977352","1700978400","1700978681",
     "1700980927","1710051743","1710074521","1710077847","1710088505","1710088752","1710103353","1710105705","1710108527","1710275722","1710903133","1710932488",
     "1710951900","1710976667","1720008410","1720051576","1720059579","1720100571","1720119860","1720121874","1720123250","1720144637","1720146418","1720156912",
     "1720169972","1720196454","1720246705","1720294978","1730117250","1730121856","1730124777","1730127606","1730129123","1730140153","1730141573","1730156050",
     "1730162090","1730171877","1730177056","1730181231","1730193962","1730197591","1730199472","1730227133","1730497710","1730526450","1740250752","1740252295",
     "1740255330","1740264902","1740265214","1740266501","1740266790","1740270941","1740277664","1740285147","1740309368","1740328152","1740354638","1740371269",
     "1740492966","1740496512","1740526060","1750306593","1750309001","1750333704","1750348751","1750354411","1750359550","1750361788","1750363255","1750368312",
     "1750379087","1750384707","1750402509","1750431250","1750453585","1750496857","1760406904","1760429187","1760440028","1760446496","1760450597","1760454276",
     "1760462295","1760465595","1760473276","1760493068","1760502975","1760525885","1760538110","1760555882","1760564595","1760566954","1760571491","1760592935",
     "1760631063","1760651905","1760708853","1770513335","1770527756","1770557563","1770557738","1770560690","1770564270","1770580029","1770602567","1770677429",
     "1770764383","1780602086","1780609495","1780610105","1780612416","1780626754","1780663799","1780664714","1780678813","1780780668","1780781369","1780784496",
     "1780788398","1780788968","1780834580","1780842351","1780973057","1790052652","1790710119","1790734630","1790738953","1790749877","1790754539","1790756096",
     "1790777647","1790781326","1790828556","1790852580","1790855625","1790859270","1790891448","1790891679","1790931210","1790955177","1790956621","1790968659",
     "1801007109","1801031836","1801058649","1801059514","1801209721","1801234471","1801843537","1801848270","1801853742","1801865027","1801873922","1801874169",
     "1801897137","1801897814","1801899398","1801936802","1801962881","1801962931","1801963988","1801976048","1811008790","1811017254","1811018880","1811033913",
     "1811044670","1811127814","1811169063","1811183585","1811200967","1811335433","1811904550","1811909708","1811931959","1811957566","1811963234","1811975980",
     "1811989106","1821040320","1821049487","1821054586","1821056649","1821057662","1821076712","1821080672","1821095159","1821095183","1821131046","1821133489",
     "1821178955","1821241845","1821259342","1831102870","1831112259","1831136456","1831155241","1831169366","1831173178","1831174366","1831174697","1831178250",
     "1831182237","1831207117","1831234681","1831236405","1831267590","1831367515","1831381854","1831526367","1841231958","1841242351","1841249190","1841260676",
     "1841271400","1841278678","1841279494","1841288156","1841309028","1841399706","1841449337","1841502689","1851307755","1851308258","1851310510","1851313209",
     "1851354997","1851355283","1851385553","1851388904","1851394803","1851451793","1851465256","1851477129","1851485239","1851488316","1851586689","1851588693",
     "1851593040","1851596266","1861403099","1861406324","1861421794","1861433328","1861437543","1861471583","1861472649","1861476830","1861491920","1861503815",
     "1861569261","1861574063","1861576126","1861597171","1861616237","1861779241","1871521823","1871542597","1871545459","1871560144","1871561167","1871563569",
     "1871566687","1871576991","1871597583","1871608158","1871641985","1871650176","1871657510","1871678961","1871683532","1871785196","1871934489","1881616779",
     "1881627107","1881664597","1881665024","1881670867","1881671113","1881676567","1881684207","1881692382","1881697571","1881699981","1881705143","1881738664",
     "1881747889","1881771798","1881857886","1891011680","1891066650","1891723730","1891733085","1891758033","1891762936","1891779013","1891783023","1891790598",
     "1891798989","1891813416","1891818415","1891847547","1891872388","1891882114","1891943262","1891943775","1891956009","1891978763","1891989190","1902057417",
     "1902131683","1902810179","1902811375","1902826035","1902826365","1902833908","1902844939","1902862246","1902867112","1902870025","1902874779","1902883010",
     "1902888506","1902898497","1902934532","1902968647","1912043738","1912087099","1912091992","1912094574","1912169376","1912349176","1912920711","1912931411",
     "1912937509","1912981788","1922041045","1922054188","1922054303","1922055037","1922060177","1922062819","1922074343","1922088137","1922091818","1922095603",
     "1922098177","1922129279","1922147065","1922176338","1922177351","1922208180","1922235688","1922286111","1932101011","1932102563","1932107109","1932120011",
     "1932123080","1932162716","1932165222","1932179983","1932186103","1932187077","1932190147","1932205382","1932247061","1932317054","1932337466","1932355310",
     "1932365533","1932389277","1932394772","1932526910","1932547064","1942211552","1942243852","1942272455","1942297833","1942304019","1942343454","1942358577",
     "1942374269","1942380373","1942381009","1942405519","1942412200","1952304016","1952363541","1952365819","1952377426","1952388704","1952411308","1952437022",
     "1952439713","1952487456","1952498206","1952499758","1952520405","1952526741","1952538209","1952588246","1962450973","1962467597","1962471938","1962472456",
     "1962473231","1962476986","1962477745","1962491829","1962491936","1962496430","1962497461","1962566851","1962572305","1962575308","1962617621","1962790287",
     "1962793604","1972503431","1972527802","1972528461","1972546976","1972560696","1972567204","1972567527","1972568889","1972578565","1972586527","1972595171",
     "1972628840","1972669125","1972681716","1972685972","1972696250","1972698264","1972745792","1972776623","1972776763","1972833317","1982607172","1982608535",
     "1982631636","1982639688","1982640298","1982640942","1982644415","1982644639","1982660643","1982679320","1982680989","1982683066","1982684346","1982693149",
     "1982697843","1982706503","1982708269","1982754842","1982767067","1982815007","1982818415","1982828190","1982859427","1982867792","1982924866","1982930491",
     "1982967030","1992717284","1992721120","1992731889","1992764476","1992765531","1992770978","1992796346","1992810972","1992821995","1992822647","1992863443",
     "1992864631","1992923858","1992935332","1992961189","1992965008"]

    ["1992864631","1992923858","1992935332","1992961189","1992965008"]
  end
end
